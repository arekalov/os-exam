---
number: 2
title: Общая организация процессора, памяти, организация вычислений.
---

## Организация процессора
- Процессор состоит из отдельных ядер
- Кэш второго уровня (L2$) соединен с частями L1$ каждого ядра, памятью и L3$.
- Кэш первого уровня (L1$) разделен на кэш с данными(D$) и инструкциями (I$). У каждого из них есть свой TLB, что помогает параллельно читать данные и инструкции.
- TLB - буфер ассоциативной трансляции, хранящий в себе недавние маппинги виртуальных и физических адресов. Ускоряет трансляцию адресов и поиск данных в кэше
- У процессора есть два набора регистров, что помогает быстрее переключать контекст двух потоков
- Вычислительный конвейер
    - Идея в том, чтобы разбить выполнение инструкции на несколько этапов, чтобы повысить тактовую частоту и производительность процесса, так как скорость, с которой процессор забирает данные, будет зависеть от того, сколько выполняется самый долгий этап.
    - Параллельность циклов исполнения и выборки команд осуществляется за счет множества АЛУ, позволяющих распараллелить очередь операций
    - Конвейер получает команду с устройства выборки команды FETCH, декодирует DECODE и отдает планировщику операций Scheduler
    - Планировщик решает, пустить ли команды параллельно и пустить ли их вообще на выполнение в зависимости от наличия данных
- Предсказатель переходов - на основании статистики предсказывает переход (выполняемую ветку условия) и отдает приказ на предварительную загрузку и исполнение. В случае успеха - экономия. В случае ошибки - сброс конвейера. В более новых архитектурах предсказатель переходов может одновременно просчитывать не одну, а несколько веток после условного перехода, так что после неверного предсказания потери меньше.
- АЛУ - обычные и специфичные для векторных операций, операций с плавающей точкой и т.п.
- Write Buffer - буферизация результатов перед записью в память, работающей медленнее исполнения команд. Процессор начинает работу со следующими командами когда данные попадают в буфер, а тот в свою очередь уже медленнее пишет это все в память.

![](images/2_proc.png)

## Организация памяти
![](images/2_org.png)
- Виртуальная память - способ организации памяти, где каждый процесс имеет свое адресное пространство, думая, что у него есть своя независимая память
- Виртуальные адреса преобразуются в физические при помощи таблиц трансляций
- Единица доступа к информации - байт. Данные объединены в страницы. Размер чаще всего 4Кб, но в некоторых случаях бывают Large и Huge страницы (до нескольких Гб)
- Преимущества такого подхода:
    - Больше памяти, чем есть физически. Редко используемые страницы выгружаются на диск (swapping), за счет этого влезает больше процессов и больших задач
    - Изоляция и защита. У каждого процесса свое пространство и в таблицах страниц отмечается какие страницы какому процессу принадлежат и какие права (rwx) есть
    - Процессу все равно где именно его страницы. Таблица страниц просто сопоставляет номера страниц со свободными физическими фреймами. За счет этого и происходит релокация.

Память компьютера организована иерархически. Самая быстрая, дорогая и маленькая - наверху, ближе всего к процессору, самая большая, медленная и дешевая - внизу. Так сделано чтобы к медленной памяти было меньше всего обращений (скорость важна знаете ли)

- Регистровая - быстрая память внутри процессора. Между основной памятью и логикой процессора есть регистры, через которые проходят данные при операциях
- Ассоциативная - поиск не по адресу, а по содержимому. За счет этого ускорение поиска необходимых записей и вообще параллельное сравнение входного значения со всеми ячейками (привет от TLB)
- Адресная - а тут наоборот обращение по адресу
- Блочная - память поделена на блоки, обращаемся тоже к блоку, а адрес получаем как номер блока + смещение в нем
- Последовательная - доступ последовательный (ну типа линкед лист)

![](images/2_pyramid.png)

## Организация вычислений
- Выборка команды (Instruction Fetch)
- Декодирование инструкции (Incstruction Decode)
- Исполнение (Execution)
- Чтение памяти (MEM)
- Запись (Write Back)
