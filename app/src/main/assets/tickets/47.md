---
number: 47
title: Влияние размера страницы виртуальной памяти на ОС. Стратегии ОС по работе с виртуальной памятью.
---

## Влияние размера страницы виртуальной памяти на ОС

Размер страницы в виртуальной памяти влияет на баланс между фрагментацией, числом страниц, нагрузкой на TLB и частотой page fault. ОС подбирает размер и стратегии так, чтобы минимизировать расходы и не убить систему свопами

- При маленькой странице меньше внутренная фрагментация. Но чем страница меньше, тем их больше в процессе, растет размер таблиц страниц и число обращений к ним, а соответственно чаще TLB miss, page fault, тк обрабатывать приходится больше мелких блоков.
- При крупной странице уменьшится число записей в TLB и таблицах, что снижает накладные расходы и число промахов. Но растет внутренняя фрагментация. Процессу выделяют крупный фрейм, из которого реально используется только часть.
- Размер страницы должен учитывать и геометрию вторичной памяти: для HDD выгодно читать/писать целые цепочки блоков на дорожке, а для современных дисков базовым размером стали 4Кб

---

## Стратегии ОС по работе с виртуальной памятью

- Стратегия выборки страниц из вторичной памяти
    - По требованию (по page fault, когда процесс реально к ней обратился)
    - Предварительная выборка - при чтении одной страницы ОС может подгрузить соседние, рассчитывая на последовательный доступ.
- Стратегия размещения
    - В современных NUMA системах скорость выше рядом с процессором процесса/потока
- Стратегия очистки (выгрузки во вторичную память)
    - По требованию - выгрузка в момент нехватки
    - Предварительная - постоянный сканнинг страниц и постепенная подготовка пула свободных страниц
- Управление многозадачностью
    - Виртуалка позволяет держать больше процессов, чем помещается целиком в ОЗУ. Так что каждому дают только резидентную часть, остальное во вторичной. И нужен баланс. ОС регулирует размер этой части и при чрезмерном свопинге админ/ОС может убрать особо требовательные процессы.
- Стратегии замещения
- Управление резидентной частью процессов (см. некст билет)