---
number: 48
title: Стратегии замещения страниц ОС. Часовой Алгоритм. Управление резидентной частью процесса.
---

## Стратегии замещения страниц
Стратегии замещения страниц

Нам нужно понимать, какие страницы и с какими приоритетами загружать в память и выгружать из нее, причем желательно еще и это предсказывать. Для этого можно учитывать прошлое поведение. Что-то выгружать вовсе нельзя (locked frames): части ядра, буферы. А что-то используется так часто, что его выгрузка повлияет на кучу процессов.

- Вводится оптимальный (идеальный) алгоритм: он всегда выбрасывает страницу, к которой обращение будет как можно позже. Он нереализуем, но служит эталоном для других алгоритмов.
- Реальные стратегии:
    - LRU (least recently used) - заменить давно не использовавшуюся страницу. В чистом виде дорого по вычислениям и хранению истории обращений
    - MRU (Most Recently Used) - заменить недавно использованную страницу, в кэше остаются старые.
    - FIFO - простой, выбрасывает самую старую по времени загрузки страницу, но дает много лишних пэйдж фолтов и может работать хуже LRU
    - LIFO - выбрасывает самую свежую по времени загрузки страницу. 
    - Различные модификации часовых алгоритмов, которые приблизительно имитируют LRU, но с меньшими расходами.

---

## Часовой алгоритм

Страницы организованы в кольцевой список и по нему ходят две стрелки: front hand и back hand.
У каждой страницы есть управляющая структура и бит использования/модификации. Передняя стрелка сбрасывает бит, помечая страницу неиспользованной. 
Задняя стрелка проверяет бит. Если за промежуток между стрелками бит стал 1, то страница использовалась и она сохраняется. А если бит остался 0, то страница становится кандидатом на вытеснение. Она либо сразу выбрасывается, либо записывается в область подкачки. При росте нагрузки ОС уменьшает расстояние между стрелками и повышает частоту сканирования

![](images/48_clock.png)

---

## Управление резидентной частью процессов
- Резидентная часть - те страницы процесса, которые реально находятся в физической памяти сейчас. Остальная часть во вторичной памяти. В современных системах нет смысла грузить процесс целиком, достаточно минимального набора страниц, а остальные подтягиваются по предварительной. Опять же, надо искать баланс. Мало памяти - много фолтов, много памяти после определенного количества страниц не дает кардинального снижения этих самых фолтов.
- Области видимости:
    - Локальная - страница замещается у процесса, вызвавшего фолт
    - Глобальная - жертва выбирается из страниц всех процессов (кроме защищенных), что позволяет отобрать действительно редко используемые страницы
- Управление резидентным множеством
    - Фиксированное распределение - в локальном замещении кол-во кадров… фиксировано, а страница выбирается среди выделенных процессу кадров. Глобальное замещение невозможно
    - Переменное распределение:
        - В локальном замещении кол-во выделенных процессу кадров может время от времени изменяться. Страница выбирается из выделенных процессу кадров
        - В глобальном страница для замещения выбирается среди всех доступных кадров в основной памяти. Это приводит к изменению резидентного множества процесса.

