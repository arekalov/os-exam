---
number: 44
title: Виртуальный страничный обмен.  Двухуровневая организация MMU и TLB 80386
---

## Виртуальный страничный обмен. Двухуровневая организация MMU и TLB 80386

**Виртуальный страничный обмен** - страничная организация виртуальной памяти с подкачной страниц по требованию

- Виртуальный адрес делится на номер страницы и смещение. Для каждой страницы есть запись в таблице страниц с номером кадра и битами состояния.
- Страницы процесса могут отсутствовать в ОЗУ, тогда page fault и загрузка страницы из вторичной памяти в свободный кадр + обновление таблицы
    - major fault - страница реально читается с диска во фрейм
    - minor fault - страница уже в памяти, но нет нужного маппинга, ядро только достраивает структуры без обращения к диску
- Таблицы страниц сами лежат в памяти и тоже могут частично отсутствовать. И их отсутствие тоже приводит к page dault и созданию/загрузке нужной page table

---

##  Двухуровневая организация MMU и TLB 80386

![](images/44_mmu.png)

На фото двухуровневая организация MMU: 

- Виртуальный адрес (память двухуровневая, 2 индекса)
    - PDE ind - указывает смещение в таблице PDT (page directory)
    - PTE ind - указывает на смещение в таблице страниц
    - Физ адрес - адрес страницы + смещение
    - PDT - таблица размещения процессов
    - PT - таблица страниц, выбирается номер страницы
    - CR3 - регистр, который указывает на начало PDT (уникален для процесса)
    - TLB - хранит последние запросы страниц (сравнивает индексы без смещения с недавними маппингами)

Алгоритм поиска страницы: берем индексы и кидаем их в TLB (без смещения). Если есть запись - сразу получаем номер кадра в физ памяти, добавляем смещение и получаем физ адрес

Если нет в TLB, то берем CR3, суммируем с PDE, находим индекс в таблице PDT, тем самым получаем нужную таблицу страниц, а дальше прибавляем к ней PTE, получаем нужную страницу, прибавляем смещение и получаем физ адрес.