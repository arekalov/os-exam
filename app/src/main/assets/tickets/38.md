---
number: 38
title: Примитивы синхронизации ОС. Неблокирующие примитивы синхронизации и неблокирующие структуры данных.
---

**Примитивы синхронизации** — это базовые механизмы, предоставляемые ОС и языками программирования для правильной организации совместного доступа к ресурсам и координации работы между процессами/потоками при параллельном выполнении.


## Предназначение примитивов синхронизации
Повзоляют избавиться от проблем параллельного выполнения:
### 1. Взаимоисключения (Mutual Exclusion)
- Ситуация, когда несколько параллельных процессов или потоков пытаются одновременно получить доступ к общему (разделяемому) ресурсу.
- Требуется механизм взаимного исключения, чтобы только один процесс/поток мог работать с этим ресурсом в данный момент времени (например, запись в файл, изменение переменной).

### 2. Взаимоблокировки (Deadlocks)
- Состояние, когда два или более процесса (потока) навечно ждут освобождения ресурсов, которые уже захвачены друг другом.
- Например: Процесс А захватил ресурс X и ждёт ресурс Y, удерживаемый процессом B, который в свою очередь ждёт освобождения ресурса X.
- Взаимоблокировка часто приводит к "заморозке" части системы.

### 3. Голодание (Starvation)
- Ситуация, когда процесс или поток длительно не может получить доступ к необходимому ресурсу из-за постоянной конкуренции с другими задачами.
- Возникает, если планировщик ресурсов отдаёт приоритет другим процессам или потокам, и "голодающий" процесс не получает своей очереди.

--- 
## Основные виды неблокирующих синхронизаций

### 1. **Wait-free** (ожидание в N шагов)
- **Суть:**  
  Любой поток завершает свою операцию за конечное число шагов (N шагов), независимо от действий других потоков.
- **Гарантия:**  
  Прогресс каждого потока всегда (!) обеспечен. Никто не "застревает" в теории или на практике.
- **Пример:**  
  Специализированные алгоритмы для очередей, стеков, счетчиков, где каждая операция имеет ограниченное число повторов.
- **Редкость:**  
  Wait-free структуры сложны в реализации, и встречаются реже других.

### 2. **Lock-free** (без блокировок/частичный прогресс)
- **Суть:**  
  Всегда гарантирован прогресс для какого-то потока: за конечное число шагов хотя бы один из участвующих потоков завершит операцию, но не обязательно все.
- **Гарантия:**  
  Система в целом не «зависает». Возможно, некоторые потоки будут вынуждены несколько раз повторить попытку из-за конфликтов (retries), но кто-то обязательно продвинется.
- **Пример:**  
  Большинство lock-free очередей и стеков (например, ConcurrentLinkedQueue в Java).

### 3. **Obstruction-free** (прогресс при отсутствии конкуренции)
- **Суть:**  
  Если в критической секции только один поток пытается выполнить операцию — он всегда завершит её за конечное число шагов.
- **Гарантия:**  
  Нет гарантии прогресса при постоянных конфликтах с другими потоками.
- **Пример:**  
  Простые алгоритмы CAS с повтором, без дополнительной логики при конфликте.

### 4. **Атомарные операции** (Atomic Operations)
- **Суть:**  
  Минимальный базовый инструмент неблокирующей синхронизации.  
  Операция выполняется как единое целое, неделимо (например, чтение и замена значения).
- **Типовые операции:**  
  - Compare-and-Swap (CAS)
  - Fetch-and-Add
  - Atomic increment/decrement
  - Exchange
- **Использование:**  
  На их основе строятся lock-free/wait-free структуры данных.

---