---
number: 3
title: Организация прерываний, типы прерываний, контроллер прерываний.
---

## Организация прерываний

Прерывание - сигнал от программного или системного обеспечения, сообщающий процессору о наступлении события, требующего немедленного внимания.
Прерывание извещает процессор о том, что наступило событие с высоким приоритетом, которое требует прерывания текущего кода, который выполняется процессором. Процессор приостанавливает активность, сохраняет состояние и выполняет функцию обработчика прерывания, которая обслуживает событие, после чего продолжает выполнение прерванный код

Контроллер прерываний (PIC, Programmable Interrupt Controller)- блок, отвечающий за возможность последовательной обработки запросов на прерывание от разных устройств, а так же за возможность подключать больше устройств.

## Контроллер прерываний

- Slave-Master PIC - у одного чипа максимум 8 линий, так что сделали каскад для увеличения их числа. К процессору обращаться может только мастер, а выход “раба” цепляют к одному из входов мастера (все как в нашем любимом…)
- IO APIC и LAPIC - когда понадобилась мультипроцессорная архитектура, придумали каждому ядру локальный Advanced PIC. Внешние же устройства кидают Interrupt Request (IRQ) в IO APIC, где по таблице перенаправления решает, на какой LAPIC отдать прерывание
- PCIe + MSI - прерывания посылаются не отдельным проводом, а записью в память (Message Signaled Interrupt), устройство делает memory write в специальный адрес LAPIC/IO APIC.
    - PCIe_Interrupt_Routing - маршрутизатор прерываний, который настраивается так, чтобы мемори записи попадали к нужному LAPIC/CPU.
- В x86 - в контроллере прерываний есть несколько процессоров, у каждого из которых локальный маршрутизатор/контроллер прерываний, обработчик прерываний. И есть IO устройства, которые посылают запрос на прерывание, логика, которая занимается обработкой и приоритетами. Локальный контроллер посылает процессору запрос на прерывание

К прерываниям есть разные подходы
Можно запретить повторные прерывания пока обрабатываются предыдущие (получится последовательная обработка прерываний)
А можно ввести систему приоритетов 

![]("images/3_pic.png")


## Типы прерываний

Асинхронные - события, исходящие от внешних аппаратных устройств. Могут произойти в любой произвольный момент. Это может быть: сигнал таймера, сетевой карты, нажатие клавиши/движение мышки. А так же события ядра (вытеснения процесса, сигналы…) Возникновение в системе такого прерывания трактуется как запрос на прерывание - устройства сообщают, что требуют внимания со стороны ОС.

Синхронные - внутренние. Результат выполнения команды. События в самом процессоре как результат нарушения условий при исполнении машинного кода (деление на ноль, переполнение стека, обращение к недопустимым адресам, недопустимый код операции)